---
import Carro from "../svg/Carro.astro";
import Avion from "../svg/Avion.astro";
import Corbata from "../svg/Corbata.astro";
import Montana from "../svg/Montana.astro";
import Mapa from "../svg/Mapa.astro";
const {lenguaje}=Astro.props
---

<section class="max-w-5xl mx-auto px-4 py-12 text-center">
  <h2 class="text-4xl font-semibold text-gray-900 mb-8">
    {lenguaje.tituloActividades}
  </h2>

  <div
    id="actividades-container"
    class="grid grid-cols-4 text-xs md:text-lg sm:grid-cols-3 md:grid-cols-5 gap-2 md:gap-4"
  >
    {
      lenguaje.servicesActividades.map((item, index) => (
        <button
          data-activity-btn
          data-index={index}
          class={`flex flex-col h-25 md:h-40 items-center text-azul-travel hover:scale-105 active:scale-95 duration-300 hover:text-white justify-center gap-2 px-2 py-4 rounded-lg transition hover:bg-azul-travel group border focus:bg-azul-travel focus:text-white active:bg-azul-travel border-gray-200`}
          aria-current={item.activo ? "true" : undefined}
        >
          {item.icon === "carrito" && <Avion style="w-10 min-h-6 h-auto " />}
          {item.icon === "guia" && (
            <Mapa style="w-10 h-auto min-h-6 text-azul-travel group-hover:text-white group-active:text-white group-focus:text-white" />
          )}
          {item.icon === "montanas" && (
            <Montana style="w-10 h-auto min-h-6 text-azul-travel group-hover:text-white group-active:text-white group-focus:text-white" />
          )}
          {item.icon === "corbata" && (
            <Corbata style="w-10 h-auto min-h-6 text-azul-travel group-hover:text-white group-active:text-white group-focus:text-white" />
          )}
          {item.icon === "4x4" && (
            <Carro style="w-10 h-auto min-h-6 text-azul-travel group-hover:text-white group-active:text-white group-focus:text-white" />
          )}

          <span class="font-medium leading-snug">{item.title}</span>
        </button>
      ))
    }
  </div>
</section>

<script>
  const INTERVALO_ROTACION = 2000; 
  const CLASE_ACTIVA = 'bg-azul-travel text-white scale-105';
  
  let currentIndex = 0;
  let intervalId: number | null = null;
  let isPaused = false;

  const buttons = document.querySelectorAll('[data-activity-btn]') as NodeListOf<HTMLElement>;
  const totalButtons = buttons.length;

  if (totalButtons === 0) {
    console.warn('No se encontraron botones de actividades');
  }

  function activateButton(index: number) {
    buttons.forEach(btn => {
      btn.classList.remove(...CLASE_ACTIVA.split(' '));
      
      const svg = btn.querySelector('svg');
      if (svg) {
        svg.style.color = '';
      }
    });

    const activeButton = buttons[index];
    if (activeButton) {
      activeButton.classList.add(...CLASE_ACTIVA.split(' '));
      
      const svg = activeButton.querySelector('svg');
      if (svg) {
        svg.style.color = 'white';
      }
    }
  }

  function rotateToNext() {
    if (isPaused) return;
    
    currentIndex = (currentIndex + 1) % totalButtons;
    activateButton(currentIndex);
  }

  function startRotation() {
    if (intervalId) return; 
    activateButton(currentIndex);
    intervalId = window.setInterval(rotateToNext, INTERVALO_ROTACION);
  }

  function stopRotation() {
    if (intervalId) {
      clearInterval(intervalId);
      intervalId = null;
    }
  }

  function restartRotation(index?: number) {
    stopRotation();
    if (typeof index === 'number') {
      currentIndex = index;
    }
    startRotation();
  }

  buttons.forEach((button, index) => {
    button.addEventListener('mouseenter', () => {
      isPaused = true;
      stopRotation();
      activateButton(index);
    });

    button.addEventListener('mouseleave', () => {
      isPaused = false;
      currentIndex = index;
      restartRotation();
    });

    button.addEventListener('click', () => {
      currentIndex = index;
      activateButton(index);
    });
  });

  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      stopRotation();
    } else if (!isPaused) {
      startRotation();
    }
  });

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', startRotation);
  } else {
    startRotation();
  }
  window.addEventListener('beforeunload', stopRotation);
</script>

<style>
  [data-activity-btn] {
    transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  [data-activity-btn] svg {
    transition: color 300ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  [data-activity-btn].bg-azul-travel {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 
                0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }
</style>
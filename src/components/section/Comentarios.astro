---
import testimonios from "../../data/testimonios.json";
let activo = 0;
const grupo = 3;
---

<section
  class=" min-h-180 p-4 md:min-h-140 md:h-[80svh] md:max-h-150 md:rounded-xl lg:max-w-4xl xl:max-w-5xl flex flex-col justify-between xl:justify-around gap-4 mx-auto overflow-hidden island-team"
>

      <span class="text-azul-travel font-semibold">Explore The Word</span>
      <h2 class="text-4xl font-bold">What Our Passenger Say?</h2>
<section class="flex flex-col md:flex-row bg-sky-100/50">
<div
    class="min-h-100 md:h-full w-full md:w-4/7 justify-center items-center flex relative overflow-hidden"
  >
    {
      testimonios.map((persona, index) => (
        <img
          src={persona.imagen}
          alt={`Foto de ${persona.nombre}`}
          class="w-60 -rotate-25 outline-2 outline-gray-300 border-8 border-white border-b-50 md:top-20 z-1 left-12 lg:left-20 xl:left-30 absolute h-auto object-cover"
          id={`imagen-principal-${index}`}
          hidden={index !== activo}
          aria-hidden={index !== activo}
        />
      ))
    }
    <img
      src={testimonios[0].imagen}
      alt={`Foto de ${testimonios[0].nombre}`}
      class="w-60 border-8 outline-1 outline-gray-300 border-white border-b-50 rotate-25 top-30 md:top-30 left-28 lg:left-40 xl:left-50 absolute h-auto object-cover"
      id="imagen-secundaria"
    />
  </div>

  <div class="py-6 px-4 md:max-w-xs lg:max-w-sm flex flex-col gap-4">
    {
      testimonios.map((persona, index) => (
        <article
          id={`testimonio-${index}`}
          class="transition-opacity duration-300 ease-in-out"
          hidden={index !== activo}
          aria-hidden={index !== activo}
        >
          <h2 class="text-lg font-bold md:min-h-14 flex flex-col text-black ">
            {persona.nombre}
            <span class="text-xs text-azul-travel ">{persona.pais}</span>
          </h2>
          
          <blockquote class="mt-2 md:min-h-60 text-gray-600  italic">
            {persona.comentario}
          </blockquote>
        </article>
      ))
    }

    <div
      class="grid grid-flow-col py-4 gap-2 mx-auto w-70 md:w-60 relative place-items-center"
    >
      {
        testimonios.map((persona, index) => (
          <button
            type="button"
            class="group rounded-full w-13 border-2 border-white dark:border-gray-800 ring-offset-2 ring-indigo-500 focus:ring"
            aria-label={`Ver perfil de ${persona.nombre}`}
            data-index={index}
            id={`btn-${index}`}
            hidden
          >
            <img
              src={persona.imagen}
              alt={persona.nombre}
              class="w-12 h-12 object-cover rounded-full group-hover:ring-2 group-hover:ring-indigo-400 transition"
            />
          </button>
        ))
      }
      <button
        type="button"
        id="prev-btnc"
        class="text-azul-travel text-3xl font-bold absolute top-0 bottom-0 -left-8"
        >←</button
      >
      <button
        type="button"
        id="next-btnc"
        class="text-azul-travel text-3xl font-bold absolute top-0 bottom-0 -right-8"
        >→</button
      >
    </div>

    <div class="flex justify-between w-full mt-2"></div>
  </div>
</section>
  
</section>

<script is:inline>
  let activo = 0;
  const grupo = 3;
  const total = document.querySelectorAll("[id^='testimonio-']").length;

  function actualizarTestimonio(index) {
    activo = index;

    document.querySelectorAll("[id^='testimonio-']").forEach((el, i) => {
      el.hidden = i !== activo;
      el.setAttribute("aria-hidden", i !== activo);
    });

    document.querySelectorAll("[id^='imagen-principal-']").forEach((img, i) => {
      img.hidden = i !== activo;
      img.setAttribute("aria-hidden", i !== activo);
    });

    const grupoInicio = Math.floor(activo / grupo) * grupo;
    const grupoFin = grupoInicio + grupo;

    document.querySelectorAll("[id^='btn-']").forEach((btn, i) => {
      const visible = i >= grupoInicio && i < grupoFin;
      btn.hidden = !visible;
      btn.setAttribute("aria-hidden", !visible);
    });
  }

  document.getElementById("next-btnc").addEventListener("click", () => {
    activo = (activo + 1) % total;
    actualizarTestimonio(activo);
  });

  document.getElementById("prev-btnc").addEventListener("click", () => {
    activo = (activo - 1 + total) % total;
    actualizarTestimonio(activo);
  });

  document.querySelectorAll("[id^='btn-']").forEach((btn) => {
    btn.addEventListener("click", () => {
      const index = parseInt(btn.dataset.index);
      actualizarTestimonio(index);
    });
  });

  actualizarTestimonio(activo); // inicial
  setInterval(() => {
    activo = (activo + 1) % total;
    actualizarTestimonio(activo);
  }, 10000);
</script>
